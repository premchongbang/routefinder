<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Route Finder</title>

    <!-- Bootstrap --
    <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.min.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]> --
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> -->

    <!-- Leaflet-->
     <link rel="stylesheet" href="/leaflet/dist/leaflet.css" />
     <script src="/leaflet/dist/leaflet-src.js"></script>

    <script type="text/javascript" src="/javascripts/map.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <!-- link to external stylesheet -->
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">

    <script type="text/javascript">
      var socket = io.connect();
      
      socket.on('renderMap', function(data){
        if(data.length > 0) {
          document.getElementById('map').innerHTML = '<div id="mapid" style="height: 550px;"> </div>';
          render_map(document.getElementById("mapid"), document.getElementsByClassName("hidden_first_loc"), data);
        } else {
          document.getElementById('map').innerHTML = '<div id="mapid" style="height: 550px;"> </div>';
          var piv = [{name:"NOACTION", data:[]}];
          render_map(document.getElementById("mapid"), document.getElementsByClassName("hidden_first_loc"), piv);
        }
      });
    </script>

  </head>
  <body>
<div id="clicker">
  <form name="form">
    <button type="button" onClick="create()">Save</button>
    <input type="text" id="text" name="lname">
  </form>
</div>
<div id="map">
  <script>
  function findDistance(lat1, lon1, lat2, lon2){
      var deg2rad = 0.017453292519943295; // === Math.PI / 180
      var cos = Math.cos;
      lat1 *= deg2rad;
      lon1 *= deg2rad;
      lat2 *= deg2rad;
      lon2 *= deg2rad;
      var a = (
          (1 - cos(lat2 - lat1)) +
          (1 - cos(lon2 - lon1)) * cos(lat1) * cos(lat2)
          ) / 2;

      return 12742 * Math.asin(Math.sqrt(a)) * 1000; // Diameter of the earth in km (2 * 6371)
  }

  var map = L.map('map').setView([50.93491, -1.3964], 16);

  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19,
        }).addTo(map);

  var popup = L.popup();

  var point = new Array();

  function drawLine(e) {
    popup
      .setLatLng(e.latlng)
      .setContent(e.latlng.toString())
      .openOn(map);
    point.push(new L.LatLng(e.latlng.lat.toFixed(5), e.latlng.lng.toFixed(5)));

    var firstpolyline = new L.polyline(point, {
          color: 'red',
          weight: 3,
          opacity: 0.5,
          smoothFactor: 1
    });

    firstpolyline.addTo(map);
    var counter = 0;
    var dist = 0;

    for(i=counter; i<point.length; i++){
      console.log(point[i].lat + ", " + point[i].lng);
      if(counter >= 1){
        dist += findDistance(point[i].lat, point[i].lng, point[i - 1].lat, point[i - 1].lng);
        console.log("distance " + dist.toFixed(2));
      }
      counter += 1;
    }
   }

   map.on('click', drawLine);

  </script>
</div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/jquery/dist/jquery.min.js"></script>
    <script src="/bootstrap/dist/js/bootstrap.min.js"></script>

  </body>
</html>